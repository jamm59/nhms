generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model User {
  // This is the user schema.
  forename               String                   @db.VarChar(16)
  surname                String?                  @db.VarChar(32)
  dob                    DateTime?                @db.Date
  email                  String                   @unique @db.VarChar(255)
  password               String                   @db.VarChar(32)
  gender                 String?                  @db.Char(1)
  userID                 String                   @id @unique @db.Char(32)
  isAdmin                Int?                     @default(0)
  // These are one to one relationships.
  Preferences            Preference?
  // These are one to many relationships.
  Logs                   Log[]
  // These are many to many relationships, represented via junction tables.
  UserToChronicCondition UserToChronicCondition[]
  UserToAllergy          UserToAllergy[]
}

model Allergy {
  // These are the list of allergies. 
  // Many users may have many allergies.
  allergyID         String          @id @unique @db.Char(32)
  allergyType       String          @db.VarChar(45)
  alternativeChoice String          @ignore @db.VarChar(45)
  UserToAllergy     UserToAllergy[]
}

model UserToAllergy {
  // This acts as a junction table from the user to the allergy.
  userID    String
  user      User    @relation(fields: [userID], references: [userID])
  allergyID String
  allergy   Allergy @relation(fields: [allergyID], references: [allergyID])

  // This acts as a compound ID.
  @@id([userID, allergyID])
}

model ChronicCondition {
  // This is the list of chronic conditions. 
  // Many users may have many chronic conditions.
  chronicID              String                   @id @unique @db.Char(32)
  conditionType          String                   @default("IBS") @db.VarChar(45)
  UserToChronicCondition UserToChronicCondition[]
}

model UserToChronicCondition {
  // This acts as a junction table from the user to the chronic condition.
  userID           String
  user             User             @relation(fields: [userID], references: [userID])
  chronicID        String
  chronicCondition ChronicCondition @relation(fields: [chronicID], references: [chronicID])

  // This acts as a compound ID.
  @@id([userID, chronicID])
}

model Food {
  // This is the list of foods that are kept in the database. 
  foodID        String  @id @unique @db.Char(32)
  foodName      String  @unique @db.VarChar(45)
  isDrink       Boolean
  protein       Int
  fat           Int
  carbohydrates Int
  vitamins      Int
  calcium       Int
  iron          Int
  potassium     Int
}

model Preference {
  // There is a one-to-one mapping between the user and the preferences, 
  // Each User has one Preference.
  preferenceID     String  @id @unique @db.Char(32)
  fontSize         Int     @default(20)
  boldText         Boolean @default(false)
  highContrastMode Boolean @default(false)
  descriptiveLinks Boolean @default(true)
  darkMode         Boolean @default(false)

  user_userID String @unique @db.Char(32)
  user        User   @relation(fields: [user_userID], references: [userID], onDelete: Cascade, onUpdate: Cascade)
}

model Symptom {
  // This is where all the symptoms are kept.
  symptomID   String  @id @unique @db.VarChar
  symptomName String? @db.VarChar
}

model Log {
  // This is where all the log entries are.
  logID     String   @id @db.VarChar(32)
  timestamp DateTime @db.Timestamp()
  logType   String   @db.VarChar(12)

  // One to many relation between a user and their log.
  user        User?      @relation(fields: [user_UserID], references: [userID], onDelete: Cascade, onUpdate: Cascade)
  user_UserID String?    @db.Char(32)
  // One to one relationship between a logID and the health log.
  logHealth   HealthLog?
}

model HealthLog {
  // This is where the health log entries can be found. These will have a tag of health
  // in the logtype.
  healthID           String @id @unique @db.Char(32)
  height             Int?
  weight             Int?
  bloodPressure      Int?
  bloodGlucoselevels Int?

  //This maps the relation to the logID. 
  log_logID String @unique @db.VarChar(32)
  LogID     Log    @relation(fields: [log_logID], references: [logID], onDelete: Cascade, onUpdate: Cascade)
}
